!function(a){a.freebase=function(){console.log(d);var b=function(){function c(b){console.log(b),a("body").append(JSON.stringify(b))}function e(a){try{return JSON.parse(a)}catch(b){return a}}var b={};if("undefined"!=typeof window&&window.screen)b.get=function(b,d){d=d||c,a.get(b,function(a){d(e(a))}).fail(function(a){d(a.statusText||"error")})},b.jsonp=function(b,d){d=d||c,a.getJSON(b,function(a){d(e(a))}).fail(function(a){d(a.statusText||"error")})},b.post=function(b,d,f){f=f||c,a.post(b,d,function(a){f(e(a))}).fail(function(a){f(a.statusText||"error")})};else if("undefined"!=typeof module&&module.exports){var d=require("request");b.get=function(a,b){b=b||console.log,d({uri:a},function(a,c,d){b(e(d))})},b.post=function(a,b,c){c=c||console.log,"object"==typeof b&&(b=JSON.stringify(b)),d({url:"http://api.freebase.com/api/service/mqlread",method:"POST",body:b},function(a,b,d){c(e(d))})}}return"undefined"!=typeof define&&define.amd?define([],function(){return b}):"undefined"!=typeof module&&module.exports&&(module.exports=b),b}(),c=function(){var a={kill:["/music/track","/music/release_track","/tv/tv_episode","/music/recording","/music/composition","/book/book_edition"],boring:["/type/object/attribution","/type/object/key","/type/object/mid","/common/topic/notable_properties","/type/object/guid","/type/object/type","/type/object/id","/type/object/creator","/type/object/timestamp","/type/object/permission","/common/topic/alias","/common/topic/article","/common/topic/image","/common/topic/notable_for","/common/topic/notable_types","/common/topic/official_website","/common/topic/topic_equivalent_webpage","/common/topic/topical_webpage","/travel/travel_destination_monthly_climate/month","/location/religion_percentage/religion"],sentence_grammars:[],plural_types:["/music/instrument","/business/product_category","/biology/animal","/aviation/aircraft_type","/base/aareas/schema/administrative_area_type","/user/spencermountain/default_domain/type_of_music_group","/geography/geographical_feature_category","/award/award_discipline","/fashion/garment","/interests/collection_category","/organization/organization_type","/geology/rock_type","/sports/sports_equipment","/fictional_universe/fictional_organization_type","/user/jamie/default_domain/retail_category","/base/localfood/produce","/base/disaster2/type_of_injury","/architecture/type_of_museum","/automotive/engine_type","/travel/accommodation_feature","/transportation/bridge_type","/food/type_of_dish","/automotive/automotive_class","/geography/mountain_type","/exhibitions/type_of_exhibition","/user/alecf/recreation/park_feature","/event/disaster_type","/meteorology/cloud","/base/events/type_of_festival","/american_football/football_position","/base/piercings/piercing_location","/religion/type_of_place_of_worship","/base/birdinfo/type_of_diet","/astronomy/type_of_planetographic_feature","/base/forts/type_of_fort","/travel/accommodation_type","/base/crime/lawyer_type","/base/argumentmaps/type_of_joke","/base/events/type_of_performance","/event/type_of_public_presentation","/user/alexander/toys/toy_type","/user/robert/mobile_phones/input_interface","/baseball/baseball_position","/theater/theater_production_staff_role","/soccer/football_position","/music/voice","/base/disaster2/type_of_injury_causing_event","/base/services/exercise_facilities","/conferences/type_of_conference","/base/ecology/type_of_ecosystem","/bicycles/bicycle_type","/basketball/basketball_position","/base/movietheatres/type_of_movie_theatre_cinema","/base/disaster2/type_of_automobile_accident","/ice_hockey/hockey_position","/base/fires/type_of_fire","/base/crime/type_of_criminal_organization","/base/skateboarding/type_of_skateboarding_obstacle","/spaceflight/satellite_type","/base/represent/type_of_agent","/user/rcheramy/default_domain/fruit","/user/rcheramy/default_domain/food","/biology/organism_classification","/business/job_title","/medicine/anatomical_structure","/people/profession","/fictional_universe/character_species","/user/rcheramy/default_domain/hockey_team","/ice_hockey/hockey_team","/sports/sports_team","/sports/professional_sports_team","/base/events/event_presenting_organisation","/film/film_genre","/music/compositional_form","/medicine/drug_class","/geography/lake_type","/user/akatenev/weapons/weapon","/user/spencermountain/default_domain/stock_character","/base/folklore/mythical_creature"],category_like:["/american_football/football_position/players","/architecture/architectural_style/architects","/baseball/baseball_position/players","/basketball/basketball_position/players","/basketball/basketball_roster_position/player","/business/competitive_space_mediator/company","/business/industry/companies","/business/market_share/company","/comic_strips/comic_strip_creator_duration/creator_of_strip","/dining/cuisine/chefs","/dining/cuisine/restaurant","/education/education/student","/education/field_of_study/academic_departments","/education/field_of_study/academics_in_this_field","/film/film_film_company_relationship/film_company","/food/diet/followers","/ice_hockey/hockey_position/players","/interests/hobby/people_with_this_hobby","/interests/interest/people_with_this_interest","/martial_arts/martial_art/well_known_practitioner","/medicine/medical_specialty/hospitals_with_this_specialty","/medicine/medical_specialty/physicians_with_this_specialty","/music/genre/artists","/music/group_membership/member","/music/recording_contribution/contributor","/music/track_contribution/contributor","/olympics/olympic_athlete_affiliation/athlete","/opera/opera_designer_gig/designer","/opera/opera_production_staff_gig/staff_member","/organization/club_interest/clubs","/organization/leadership/person","/organization/organization_board_membership/member","/organization/organization_sector/organizations_in_this_sector","/people/profession/people_with_this_profession","/projects/project_participation/participant","/religion/religion/organizations","/soccer/football_position/players","/sports/pro_sports_played/athlete","/sports/sport/leagues","/sports/sport/officials","/sports/sport/team_coaches","/sports/sport/teams","/sports/sports_team_roster/player","/theater/theater_designer_gig/designer","/theater/theater_production_staff_gig/staff_member","/tv/tv_crew_gig/crewmember","/tv/tv_producer_episode_credit/producer","/tv/tv_producer_term/producer","/tv/tv_regular_personal_appearance/person","/visual_art/visual_art_form/artists","/government/form_of_government/countries","/people/ethnicity/people","/fictional_universe/character_gender","/fictional_universe/fictional_character/ethnicity","/architecture/structure/architectural_style","/book/book/genre","/book/magazine/genre","/book/short_story/genre","/book/written_work/school_or_movement","/broadcast/content/genre","/broadcast/radio_station/format","/comic_books/comic_book_series/genre","/comic_books/comic_book_story/genre","/comic_strips/comic_strip/genre","/computer/software/software_genre","/cvg/computer_videogame/cvg_genre","/film/film/genre","/food/dish/cuisine","/games/game/genre","/internet/website/category","/media_common/netflix_title/netflix_genres","/music/album/genre","/music/music_video/music_video_genre","/opera/opera/genre","/theater/play/genre","/tv/tv_program/genre","/visual_art/artwork/art_genre","/visual_art/artwork/period_or_movement","/automotive/model/model_years","/automotive/model_year/examples","/aviation/aircraft_model/aircraft","/award/recurring_competition/individual_competitions","/conferences/conference_series/conference","/cricket/cricket_series/series_events","/cricket/cricket_tournament/events","/film/film_festival/individual_festivals","/food/dish/recipes","/rail/locomotive_class/locomotives_of_this_class","/sports/sports_championship/events","/sports/tournament_event/competitions","/time/recurring_event/instances","/fictional_universe/character_occupation/characters_with_this_occupation"],related_properties:["/influence/influence_node/influenced_by","/location/location/adjoin_s","/influence/influence_node/influenced","/location/location/coterminous_with","/location/location/near","/time/event/included_in_event","/time/event/includes_event","/film/film/subjects","/film/film/sequel","/film/film/prequel","/film/film/directed_by","/film/film/starring","/book/written_work/previous_in_series","/book/written_work/next_in_series","/book/written_work/subjects","/visual_art/artwork/art_subject","/visual_art/artwork/belongs_to_series","/education/educational_institution/subsidiary_or_constituent_schools","/education/educational_institution/parent_institution","/organization/organization/sectors","/organization/organization/spun_off_from","/organization/organization/spin_offs","/organization/organization/parent","/organization/organization/child","/biology/organism_classification/higher_classification","/biology/organism_classification/lower_classifications","/biology/organism_classification/child_classifications","/biology/organism_classification/parent_classifications","/sports/sports_facility/teams","/sports/sports_league/championship","/sports/sport/leagues","/sports/sports_team/arena_stadium","/sports/sports_team/location","/sports/sports_team_location/teams","/government/political_party/ideology","/government/political_district/elections","/government/election/winner","/music/track/artist","/time/recurring_event/instances","/people/profession/specializations","/people/profession/specialization_of","/music/artist/label","/music/artist/album","/music/release/label","/music/release/album","/music/album/artist","/music/musical_group/member","/music/producer/releases_produced","/base/onephylogeny/type_of_thing/includes","/base/onephylogeny/type_of_thing/included_in","/location/country/capital","/location/country/form_of_government","/location/country/currency_used","/location/country/national_anthem","/aviation/airport/serves","/architecture/structure/architect","/geography/lake/cities","/geography/lake/outflow","/geography/lake/inflow","/olympics/olympic_games/host_city","/olympics/olympic_host_city","/business/employment_tenure/company","/film/performance/film","/tv/regular_tv_appearance/series","/people/marriage/spouse","/education/education/specialization","/education/education/major_field_of_study","/location/adjoining_relationship/adjoins","/music/group_membership/group","/celebrities/friendship/friend","/base/popstra/friendship/participant","/people/person/parents","/influence/influence_node/peers","/people/person/children","/people/sibling_relationship/sibling","/location/location/contains"],definate_articles:["/geography/mountain_range","/location/region","/royalty/noble_title","/user/pak21/default_domain/tectonic_plate","/education/university","/education/department","/religion/religious_organization","/user/robinboast/default_domain/historical_period","/travel/tourist_attraction","/comic_books/comic_book_character","/transportation/bridge","/business/shopping_center","/base/argumentmaps/intellectual_dispute","/base/argumentmaps/argument","/geography/island_group"],properties:[],is_a:["/amusement_parks/ride/ride_type","/amusement_parks/roller_coaster/propulsion","/amusement_parks/roller_coaster/train_configuration","/architecture/building/building_function","/architecture/museum/type_of_museum","/astronomy/asteroid/spectral_type","/astronomy/celestial_object/category","/astronomy/extraterrestrial_location/type_of_planetographic_feature","/astronomy/galaxy/galaxy_classification_hubble","/astronomy/galaxy_classification_code/galaxy_shape","/astronomy/near_earth_object/near_earth_object_classification","/astronomy/orbital_relationship/orbit_type","/astronomy/star/spectral_type","/astronomy/telescope/type_of_telescope","/automotive/model/automotive_class","/automotive/transmission/classification","/aviation/aircraft_model/aircraft_type","/aviation/airliner_accident/accident_type","/aviation/airport/airport_type","/aviation/aviation_waypoint/waypoint_type","/award/competition/type_of_competition","/bicycles/bicycle_model/bicycle_type","/biology/breed_registration/breed_group","/biology/fossil_specimen/organism","/biology/gene_group_membership/group","/biology/gene_ontology_group/group_type","/biology/organism/organism_type","/biology/organism/sex","/biology/organism_classification/rank","/biology/pedigreed_animal/breed","/boats/ship/ship_class","/boats/ship_class/ship_type","/book/book_edition/binding","/book/periodical_format_period/format","/book/poem/verse_form","/book/short_non_fiction/mode_of_writing","/business/consumer_product/category","/business/issue/type_of_issue","/business/product_line/category","/celebrities/sexual_orientation_phase/sexual_orientation","/chemistry/chemical_compound/classifications","/chemistry/chemical_element/chemical_series","/chemistry/chemical_element/periodic_table_block","/computer/computer_peripheral/peripheral_class","/computer/file_format/genre","/conferences/conference_series/type_of_conference","/cricket/cricket_match/match_type","/cvg/computer_videogame/gameplay_modes","/digicams/digital_camera/format","/distilled_spirits/blended_spirit/style","/distilled_spirits/distilled_spirit/spirit_type","/distilled_spirits/infused_spirit/infusion_style","/education/educational_institution/school_type","/education/fraternity_sorority/fraternity_sorority_type","/engineering/battery/cell_type","/engineering/battery/size","/engineering/battery_size/shape_format","/engineering/engine/category","/engineering/piston_engine/cooling_method","/engineering/piston_engine/fuel_delivery_method","/engineering/piston_engine/piston_configuration","/engineering/piston_engine/valvetrain_configuration","/engineering/power_plug_standard/plug_type","/event/disaster/type_of_disaster","/event/speech_or_presentation/type_or_format_of_presentation","/exhibitions/exhibition/exhibition_types","/fashion/textile/weave","/fictional_universe/fictional_setting/setting_type","/film/film/film_format","/food/beer/beer_style","/food/beer_style/bjcp_style_category","/food/cheese/texture","/food/dish/type_of_dish1","/food/drinking_establishment/drinking_establishment_type","/food/tea/tea_type","/food/wine_style/wine_types","/geography/geographical_feature/category","/geography/glacier/glacier_type","/geography/lake/lake_type","/geography/mountain/listings","/geography/mountain/mountain_type","/geography/waterfall/waterfall_type","/government/government_office_or_title/category","/government/government_position_held/basic_title","/interests/collectable_item/collection_category","/internet/top_level_domain/domain_type","/language/conlang/conlang_type","/language/language_writing_system/type_of_writing","/law/us_patent/international_classification","/law/us_patent/us_classification_category","/law/us_patent/us_patent_type","/location/administrative_division_capital_relationship/capital_type","/location/country/form_of_government","/location/location_symbol_relationship/Kind_of_symbol","/martial_arts/martial_art/category","/medicine/cancer_center/cancer_center_type","/medicine/drug/drug_class","/medicine/drug/mechanism_of_action","/medicine/drug_formulation/dosage_form","/medicine/drug_formulation/drug_category","/medicine/hospital_ownership/ownership_status","/medicine/infectious_disease/infectious_agent_type","/medicine/medical_trial/design","/medicine/medical_trial/phase","/medicine/medical_trial/type_of_trial","/meteorology/cloud/classification","/meteorology/tropical_cyclone/category","/metropolitan_transit/transit_line/service_type","/military/military_unit/unit_size","/music/album/release_type","/music/composition/form","/music/opera_singer/voice_type","/music/release/format","/organization/organization/legal_structure","/organization/organization/organization_type","/people/person/ethnicity","/people/person/gender","/physics/particle/family","/physics/particle/generation","/protected_sites/natural_or_cultural_site_designation/categories","/protected_sites/natural_or_cultural_site_listing/designation","/protected_sites/protected_site/iucn_category","/rail/locomotive_class/gauge","/rail/railway_gauge_relationship/gauge","/rail/railway_type_relationship/railway_type","/rail/steam_locomotive_class/fuel_type","/rail/steam_locomotive_class/wheel_configuration","/religion/place_of_worship/religion","/religion/place_of_worship/type_of_place_of_worship","/religion/place_of_worship_historical_use/religion","/religion/religious_leadership_jurisdiction/size_or_type","/royalty/chivalric_rank/gender","/royalty/noble_rank/gender","/royalty/order_of_chivalry/category","/skiing/lift_tenure/lift_type","/skiing/ski_run/rating","/spaceflight/bipropellant_rocket_engine/engine_cycle","/spaceflight/rocket/rocket_function","/spaceflight/satellite/primary_use","/sports/boxer/weight_division","/time/holiday/type_of_holiday","/transportation/bridge/bridge_type","/travel/accommodation/accommodation_type","/visual_art/artwork/art_form","/wine/wine/color","/wine/wine/wine_style","/wine/wine/wine_type","/zoos/zoo/category","/people/person/profession","/soccer/football_player/position_s","/american_football/football_historical_roster_position/position_s","/american_football/football_player/position_s","/american_football/football_roster_position/position","/baseball/baseball_player/position_s","/baseball/baseball_roster_position/position","/basketball/basketball_player/position_s","/basketball/basketball_roster_position/position","/ice_hockey/hockey_player/hockey_position","/ice_hockey/hockey_roster_position/position","/soccer/football_player/position_s","/soccer/football_roster_position/position"],metaschema:[{name:"HasPlaceOfOrigin",search:"origin",id:"/base/fbontology/metaschema/predicate_id/hasplaceoforigin"},{name:"Portrayed",search:"portrayed",id:"/base/fbontology/metaschema/predicate_id/portrayed"},{name:"PortrayedBy",search:"portrayed_by",id:"/base/fbontology/metaschema/predicate_id/portrayedby"},{name:"HasCategory",search:"category",id:"/base/fbontology/metaschema/predicate_id/hascategory"},{name:"Administers",search:"administers",id:"/base/fbontology/metaschema/predicate_id/administers"},{name:"AdministeredBy",search:"administered_by",id:"/base/fbontology/metaschema/predicate_id/administeredby"},{name:"OccursIn",search:"occurs_in",id:"/base/fbontology/metaschema/predicate_id/occursin"},{name:"Produced",search:"produced",id:"/base/fbontology/metaschema/predicate_id/produced"},{name:"ProducedBy",search:"produced_by",id:"/base/fbontology/metaschema/predicate_id/producedby"},{name:"HasLocation",search:"location",id:"/base/fbontology/metaschema/predicate_id/haslocation"},{name:"HasTitle",search:"title",id:"/base/fbontology/metaschema/predicate_id/hastitle"},{name:"HasPart",search:"part",id:"/base/fbontology/metaschema/predicate_id/haspart"},{name:"PartOf",search:"part_of",id:"/base/fbontology/metaschema/predicate_id/partof"},{name:"ComposedOf",search:"made_of",id:"/base/fbontology/metaschema/predicate_id/composedof"},{name:"ParticipatedIn",search:"participated_in",id:"/base/fbontology/metaschema/predicate_id/participatedin"},{name:"HasParticipant",search:"participant",id:"/base/fbontology/metaschema/predicate_id/hasparticipant"},{name:"Discovered",search:"discovered",id:"/base/fbontology/metaschema/predicate_id/discovered"},{name:"DiscoveredBy",search:"discovered_by",id:"/base/fbontology/metaschema/predicate_id/discoveredby"},{name:"HasStatus",search:"status",id:"/base/fbontology/metaschema/predicate_id/hasstatus"},{name:"PractitionerOf",search:"practitioner_of",id:"/base/fbontology/metaschema/predicate_id/practitionerof"},{name:"HasPractitioner",search:"practitioner",id:"/base/fbontology/metaschema/predicate_id/haspractitioner"},{name:"HasServiceArea",search:"service_area",id:"/base/fbontology/metaschema/predicate_id/hasservicearea"},{name:"HasChild",search:"child",id:"/base/fbontology/metaschema/predicate_id/haschild"},{name:"HasParent",search:"parent",id:"/base/fbontology/metaschema/predicate_id/hasparent"},{name:"HasPublication",search:"publication",id:"/base/fbontology/metaschema/predicate_id/haspublication"},{name:"PublicationOf",search:"publication_of",id:"/base/fbontology/metaschema/predicate_id/publicationof"},{name:"MemberOf",search:"member_of",id:"/base/fbontology/metaschema/predicate_id/memberof"},{name:"LeaderOf",search:"leader_of",id:"/base/fbontology/metaschema/predicate_id/leaderof"},{name:"HasLeader",search:"leader",id:"/base/fbontology/metaschema/predicate_id/hasleader"},{name:"HasOwner",search:"owner",id:"/base/fbontology/metaschema/predicate_id/hasowner"},{name:"Owns",search:"owns",id:"/base/fbontology/metaschema/predicate_id/owns"},{name:"PeerOf",search:"peer_of",id:"/base/fbontology/metaschema/predicate_id/peerof"},{name:"ExhibitedAt",search:"exhibited_at",id:"/base/fbontology/metaschema/predicate_id/exhibitedat"},{name:"Exhibited",search:"exhibited",id:"/base/fbontology/metaschema/predicate_id/exhibited"},{name:"DistributedBy",search:"distributed_by",id:"/base/fbontology/metaschema/predicate_id/distributedby"},{name:"HasName",search:"name",id:"/base/fbontology/metaschema/predicate_id/hasname"},{name:"SuperclassOf",search:"superclass_of",id:"/base/fbontology/metaschema/predicate_id/superclassof"},{name:"SubclassOf",search:"subclass_of",id:"/base/fbontology/metaschema/predicate_id/subclassof"},{name:"TookPlaceAt",search:"tookplace_at",id:"/base/fbontology/metaschema/predicate_id/tookplaceat"},{name:"HasFictionalRelationship",search:"fiction_link",id:"/base/fbontology/metaschema/predicate_id/hasfictionalrelationship"},{name:"HasGenre",search:"genre",id:"/base/fbontology/metaschema/predicate_id/hasgenre"},{name:"SucceededBy",search:"succeeded_by",id:"/base/fbontology/metaschema/predicate_id/succeededby"},{name:"Succeeds",search:"succeeds",id:"/base/fbontology/metaschema/predicate_id/succeeds"},{name:"UsePermittedBy",search:"use_permitted_by",id:"/base/fbontology/metaschema/predicate_id/usepermittedby"},{name:"PermitsUseOf",search:"permits_use_of",id:"/base/fbontology/metaschema/predicate_id/permitsuseof"},{name:"ContributedTo",search:"contributed_to",id:"/base/fbontology/metaschema/predicate_id/contributedto"},{name:"HasContributor",search:"contributor",id:"/base/fbontology/metaschema/predicate_id/hascontributor"},{name:"HasIdentifier",search:"name",id:"/base/fbontology/metaschema/predicate_id/hasidentifier"},{name:"Identifies",search:"identifies",id:"/base/fbontology/metaschema/predicate_id/identifies"},{name:"HasCenter",search:"center",id:"/base/fbontology/metaschema/predicate_id/hascenter"},{name:"CenterFor",search:"center_for",id:"/base/fbontology/metaschema/predicate_id/centerfor"},{name:"HasCharacter",search:"character",id:"/base/fbontology/metaschema/predicate_id/hascharacter"},{name:"AppearsIn",search:"appears_in",id:"/base/fbontology/metaschema/predicate_id/appearsin"},{name:"BroaderThan",search:"broader_than",id:"/base/fbontology/metaschema/predicate_id/broaderthan"},{name:"NarrowerThan",search:"narrower_than",id:"/base/fbontology/metaschema/predicate_id/narrowerthan"},{name:"ExpressedBy",search:"expressed_by",id:"/base/fbontology/metaschema/predicate_id/expressedby"},{name:"HasCertification",search:"certification",id:"/base/fbontology/metaschema/predicate_id/hascertification"},{name:"CertificationOf",search:"certification_of",id:"/base/fbontology/metaschema/predicate_id/certificationof"},{name:"HasPreceedingWork",search:"preceeding",id:"/base/fbontology/metaschema/predicate_id/haspreceedingwork"},{name:"HasSubsequentWork",search:"subsequent",id:"/base/fbontology/metaschema/predicate_id/hassubsequentwork"},{name:"Created",search:"created",id:"/base/fbontology/metaschema/predicate_id/created"},{name:"CreatedBy",search:"created_by",id:"/base/fbontology/metaschema/predicate_id/createdby"},{name:"HasAdaptation",search:"adaptation",id:"/base/fbontology/metaschema/predicate_id/hasadaptation"},{name:"AdaptationOf",search:"adaptation_of",id:"/base/fbontology/metaschema/predicate_id/adaptationof"},{name:"HasMeasurement",search:"number",id:"/base/fbontology/metaschema/predicate_id/hasmeasurement"},{name:"HasAbstraction",search:"abstraction",id:"/base/fbontology/metaschema/predicate_id/hasabstraction"},{name:"AbstractionOf",search:"abstraction_of",id:"/base/fbontology/metaschema/predicate_id/abstractionof"},{name:"HasMeansOfDemise",search:"means_of_demise",id:"/base/fbontology/metaschema/predicate_id/hasmeansofdemise"},{name:"HasSubject",search:"subject",id:"/base/fbontology/metaschema/predicate_id/hassubject"}]};return"undefined"!=typeof define&&define.amd?define([],function(){return a}):"undefined"!=typeof module&&module.exports&&(module.exports={data:a}),a}();if("undefined"!=typeof module&&module.exports)var d=require("underscore"),e=require("async"),c=require("./data.js").data,b=require("./http.js");var f=function(){var a=10,f={};return f.isarray=function(a){return"[object Array]"==toString.call(a)},f.isobject=function(a){return a===Object(a)},f.flatten=function(a,b,c){return a.each(function(a){f.isarray(a)?b?push.apply(c,a):flatten(a,b,c):c.push(a)}),c},f.last=function(a){return a[a.length]},f.compact=function(a){return a.filter(function(a){return a})},f.compact_strong=function(a){return d.unique(d.compact(a)).filter(function(a){return 0==d.isEmpty(a)})},f.settle_params=function(a,b,c){var d={valid:!1,q:a[0],options:a[1]||{},callback:a[2]||console.log,defaults:c||{},method:b||""};if("function"==typeof d.options&&(d.callback=d.options,d.options={}),d.options.verbose){var e=d.callback;d.callback=function(a){return e(a)}}if(f.isarray(d.q)){if(d.q.length>1)return d.q=f.compact_strong(d.q),d.valid=!0,d.array=!0,d;d.q=d.q[0]}if("object"==typeof d.q&&(d.q=d.q.id||d.q.mid||d.q.name),"string"!=typeof d.q||"object"!=typeof d.options||"function"!=typeof d.callback)return d;d.q.match(/\/.*?\/.*?/)&&(d.is_id=!0);for(var g in d.defaults)d.options[g]=d.options[g]||d.defaults[g];return d.q=d.q.replace(/  /," "),d.q=d.q.replace(/^\s+|\s+$/,""),d.q.match(/^(https?:\/\/|www\.)/)&&(d.q=d.q.replace(/\/$/,""),d.q=d.q.replace(/^https/,"http"),d.url=!0),d.valid=!0,d},f.topk=function(a,b){var c=[];b=b||1;for(var e,d={},e=a.length-1;e>-1;e--){var f=a[e];null==d[f]?d[f]=1:d[f]++}for(var f in d)c.push(f);return c.sort(function(a,b){return d[b]-d[a]}).map(function(a){return{value:a,count:d[a],percentage:(100*(d[a]/b)).toFixed(2)}})},f.percentage=function(a,b){return parseInt(100*(a/b))},f.kill_boring=function(a){return a?(c.boring.forEach(function(b){delete a[b]}),a):{}},f.parse_topic_api=function(a){var c=[];return a=f.kill_boring(a),Object.keys(a).forEach(function(b){var d=a[b];"object"==d.valuetype&&(d.values=d.values.map(function(a){return a.property=b,a}),c=c.concat(d.values)),"compound"==d.valuetype&&d.values.forEach(function(a){a.property=f.kill_boring(a.property),Object.keys(a.property).forEach(function(d){"object"==a.property[d].valuetype&&(a.property[d].values=a.property[d].values.map(function(a){return a.property=[b,d],a}),c=c.concat(a.property[d].values))})})}),c=c.map(function(a){return{name:a.text,id:a.id,property:a.property}}),c=c.map(function(a){return f.isarray(a.property)&&(a.property=a.property.join("")),a})},f.metaschema_lookup=function(a){a=a.toLowerCase(),a=a.replace(/\W(is|was|are|will be|has been)\W/," "),a=a.replace(/  /g," "),a=a.replace(/_/g," "),a=a.replace(/^\s+|\s+$/,"");var b=c.metaschema.filter(function(b){return b.aliases=b.aliases||[],b.id==a||b.name.toLowerCase()==a||f.isin(a,b.aliases)||b.search.replace(/_/g," ")==a})[0];return b=b||{},b.search},f.singularize=function(a){function l(a,b){return a.length>=b.length&&a.substring(a.length-b.length)==b}function m(a,b){if("string"==typeof a){var c=b.charAt(0).toLowerCase()!=b.charAt(0);return c?a.charAt(0).toUpperCase()+a.substr(1):a}var d=[];for(var e in a){var f=a[e];d.push(m(f,b))}return d}if(a.match(" ")){var b=a.split(" "),c=b[b.length-1],d=b.slice(0,-1);return d.join(" ")+" "+f.singularize(c)}var e={about:1,above:1,across:1,after:1,against:1,along:1,among:1,around:1,at:1,before:1,behind:1,below:1,beneath:1,beside:1,between:1,beyond:1,but:1,by:1,despite:1,down:1,during:1,except:1,"for":1,from:1,"in":1,inside:1,into:1,like:1,near:1,of:1,off:1,on:1,onto:1,out:1,outside:1,over:1,past:1,since:1,through:1,throughout:1,till:1,to:1,toward:1,under:1,underneath:1,until:1,up:1,upon:1,"with":1,within:1,without:1},g=[{p:"people",s:"person"},{p:"tornadoes",s:"tornado"},{p:"churches",s:"church"},{p:"countries",s:"country"},{p:"cities",s:"city"},{p:"companies",s:"company"},{p:"monkies",s:"monkey"},{p:"donkies",s:"donkey"},{p:"mysteries",s:"mystery"},{p:"authors",s:"author"}],h={beef:{anglicized:"beefs",classical:"beeves"},brother:{anglicized:"brothers",classical:"brethren"},child:{anglicized:null,classical:"children"},cow:{anglicized:null,classical:"kine"},ephemeris:{anglicized:null,classical:"ephemerides"},genie:{anglicized:null,classical:"genii"},money:{anglicized:"moneys",classical:"monies"},mongoose:{anglicized:"mongooses",classical:null},mythos:{anglicized:null,classical:"mythoi"},octopus:{anglicized:"octopuses",classical:"octopodes"},ox:{anglicized:null,classical:"oxen"},soliloquy:{anglicized:"soliloquies",classical:null},trilby:{anglicized:"trilbys",classical:null}},i=["fish","ois","sheep","deer","pox","itis"],j={bison:1,flounder:1,pliers:1,bream:1,gallows:1,proceedings:1,breeches:1,graffiti:1,rabies:1,britches:1,headquarters:1,salmon:1,carp:1,herpes:1,scissors:1,chassis:1,"high-jinks":1,"sea-bass":1,seabass:1,clippers:1,homework:1,series:1,cod:1,innings:1,shears:1,contretemps:1,jackanapes:1,species:1,corps:1,mackerel:1,swine:1,debris:1,measles:1,trout:1,diabetes:1,mews:1,tuna:1,djinn:1,mumps:1,whiting:1,eland:1,news:1,wildebeest:1,elk:1,pincers:1,moose:1,shrimp:1,"hoi polloi":1,riffraff:1,rabble:1},k=[{from:"a",to:"ae",words:["alumna","alga","vertebra"]},{from:"a",anglicized:"as",classical:"ae",words:["abscissa","amoeba","antenna","aurora","formula","hydra","hyperbola","lacuna","medusa","nebula","nova","parabola"]},{from:"a",anglicized:"as",classical:"ata",words:["anathema","bema","carcinoma","charisma","diploma","dogma","drama","edema","enema","enigma","gumma","lemma","lymphoma","magma","melisma","miasma","oedema","sarcoma","schema","soma","stigma","stoma","trauma"]},{from:"en",anglicized:"ens",classical:"ina",words:["stamen","foramen","lumen"]},{from:"ex",to:"ices",words:["codex","murex","silex"]},{from:"ex",anglicized:"exes",classical:"ices",words:["apex","cortex","index","latex","pontifex","simplex","vertex","vortex"]},{from:"is",anglicized:"ises",classical:"ides",words:["iris","clitoris"]},{from:"o",to:"os",words:["albino","archipelago","armadillo","commando","ditto","dynamo","embryo","fiasco","generalissimo","ghetto","guano","inferno","jumbo","lingo","lumbago","magneto","manifesto","medico","octavo","photo","pro","quarto","rhino","stylo"]},{from:"o",anglicized:"os",classical:"i",words:["alto","basso","canto","contralto","crescendo","solo","soprano","tempo"]},{from:"on",to:"a",words:["aphelion","asyndeton","criterion","hyperbaton","noumenon","organon","perihelion","phenomenon","prolegomenon"]},{from:"um",to:"a",words:["agendum","bacterium","candelabrum","datum","desideratum","erratum","extremum","stratum","ovum"]},{from:"um",anglicized:"ums",classical:"a",words:["aquarium","compendium","consortium","cranium","curriculum","dictum","emporium","enconium","gymnasium","honorarium","interregnum","lustrum","maximum","medium","memorandum","millenium","minimum","momentum","optimum","phylum","quantum","rostrum","spectrum","speculum","stadium","trapezium","ultimatum","vacuum","velum"]},{from:"us",anglicized:"uses",classical:"i",words:["focus","fungus","genius","incubus","nimbus","nucleolus","radius","stylus","succubus","torus","umbilicus","uterus"]},{from:"us",anglicized:"uses",classical:"us",words:["apparatus","cantus","coitus","hiatus","impetus","nexus","plexus","prospectus","sinus","status"]},{from:"",to:"i",words:["afreet","afrit","efreet"]},{from:"",to:"im",words:["cherub","goy","geraph"]}],q=a.toLowerCase();for(var r in g)if(g[r].p==a)return g[r].s;for(var s in h){var t=h[s];
if(t.anglicized===q||t.classical===q)return m(s,a)}for(var u in i)if(l(q,u))return a;if(j&&j[q])return a;var v=function(b,c,d){if(l(a,c)){var e=a.substring(a.length-c.length),f=e+t.from;for(var g in d)if(f===g)return m(f,a)}return null};for(var w in k){var t=k[w],x="to"in t&&v(t.from,t.to,t.words)||"anglicized"in t&&v(t.from,t.anglicized,t.words)||"classical"in t&&v(t.from,t.classical,t.words);if(null!=x&&"string"==typeof x)return x}for(var y in e){var z=a.indexOf(" "+y+" ");if(z>0){var A=a.substring(0,z),B=singularize(A);return null!=B?B+" "+y+" "+a.substr(z+y.length+2):null}if(z=a.indexOf("-"+y+"-"),z>0){var A=a.substring(0,z),B=singularize(A);return null!=B?B+"-"+y+"-"+a.substr(z+y.length+2):null}}var C=a.lastIndexOf(" ");if(C>0){var B=singularize(a.substring(C+1));return null!=B?a.substring(0,C+1)+B:null}return l(a,"xes")||l(a,"ses")?a.substring(0,a.length-2):l(a,"s")&&!l(a,"ss")?a.substring(0,a.length-1):a},f.sentenceparser=function(a){var b=a.split(/(\S.+?[.])(?=\s+|$)/g),c=[];for(var d in b)b[d]&&(b[d]=b[d].replace(/^\s+|\s+$/g,""),b[d].match(/(^| )(mr|dr|llb|md|bl|phd|ma|ba|mrs|miss|misses|mister|sir|esq|mstr|jr|sr|st|lit|inc|fl|ex|eg|jan|feb|mar|apr|jun|aug|sept?|oct|nov|dec)\. ?$/i)||b[d].match(/[ |\.][a-z]\.?$/i)?b[parseInt(d,10)+1]=b[d]+" "+b[parseInt(d,10)+1]:(c.push(b[d]),b[d]=""));var e=[];for(var f in c)c[f]=c[f].replace(/^\s+|\s+$/g,""),c[f]&&e.push(c[f]);return e},f.json_unique=function(a,b){var c=[];a:for(var d=0;d<a.length;d++){for(var e=0;e<c.length;e++)if(c[e]&&a[d]&&c[e][b]==a[d][b])continue a;c[c.length]=a[d]}return c},f.doit_async=function(b){b.q=b.q||[];var c=b.q.map(function(a){return{q:a,options:b.options,method:b.method}}),d=function(a,b){a.method(a.q,a.options,function(a){b(null,a)})};e.mapLimit(c,a,d,function(a,c){return b.callback(c)})},f.mql_unencode=function(a){return a=a.replace(/\$([0-9A-Fa-f]{4})/g,function(a,b){return String.fromCharCode(parseInt(b,16))})},f.groups_of=function(a,b){var c=[];for(var d in a)0===d%b?c.push([a[d]]):c[c.length-1].push(a[d]);return c},f.parseurl=function(a){for(var b={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},c=b.parser[b.strictMode?"strict":"loose"].exec(a),d={},e=14;e--;)d[b.key[e]]=c[e]||"";return d[b.q.name]={},d[b.key[12]].replace(b.q.parser,function(a,c,e){c&&(d[b.q.name][c]=e)}),d},f.set_params=function(a){var b=a;return b?Object.keys(b).map(function(a){var c=b[a];return(f.isarray(b[a])||f.isobject(b[a]))&&(c=encodeURIComponent(JSON.stringify(b[a]))),a+"="+c}).join("&"):""},f.clone=function(a){return JSON.parse(JSON.stringify(a))},f.softget=function(a,c,d){b.get(a,function(a){d(a)})},f.http=function(a,c,d){c.key&&(a+="&key="+c.key),b.get(a,d)},f.post=function(a,c,d){var e="query="+JSON.stringify({query:a,key:c.key,cursor:c.cursor});b.post("https://www.googleapis.com/freebase/v1/mqlread",e,d)},f.isin=function(a,b){return b.some(function(b){return b==a})},"undefined"!=typeof define&&define.amd?define([],function(){return f}):"undefined"!=typeof module&&module.exports&&(module.exports=f),f}();if("undefined"!=typeof module&&module.exports)var d=require("underscore"),e=require("async"),f=require("./helpers/helpers"),c=require("./helpers/data.js").data;if("undefined"!=typeof module&&module.exports)var d=require("underscore"),e=require("async"),f=require("./helpers/helpers"),c=require("./helpers/data.js").data;var g=function(){var a={};a.access_token="";var b={host:"https://www.googleapis.com/freebase/v1/",image_host:"https://www.googleapis.com/freebase/v1/image",geosearch:"http://api.freebase.com/api/service/geosearch",wikipedia_host:"http://en.wikipedia.org/w/api.php",generic_query:{id:null,name:null,mid:null,type:[]}};return a.mqlread=function(a,c,d){if(this.doc="interface to freebase's mql api",this.reference="http://wiki.freebase.com/wiki/MQL",d=d||console.log,!a)return d({});"function"==typeof c&&(d=c,c={}),c=c||{},c.uniqueness_failure=c.uniqueness_failure||"soft",c.cursor=c.cursor||"";var e=b.host+"mqlread?query="+JSON.stringify(a)+"&cursor="+c.cursor;f.http(e,c,function(a){return d(a)})},a.lookup_id=function(c,d){this.doc="generic info for an id";var g=f.settle_params(arguments,a.lookup,{type:"/common/topic"});if(g.array)return f.doit_async(g);if(!g.valid)return g.callback({});var h=f.clone(b.generic_query);h.id=g.q,a.mqlread([h],d,function(a){return a=a.result||[],g.callback(a[0]||{})})},a.search=function(){this.doc="regular search api",this.reference="http://wiki.freebase.com/wiki/ApiSearch";var g=f.settle_params(arguments,a.search,{});if(g.array)return f.doit_async(g);if(!g.valid)return g.callback({});if(g.is_id)return a.lookup_id(g.q,g.options,function(a){g.callback([a])});if(g.url)return a.url_lookup(g.q,g.options,function(a){return a&&a.result&&a.result[0]?g.callback(a.result):g.callback([])});if(g.is_id)return g.options.limit=1,a.lookup_id(g.q,g.options,g.callback);g.options.query=encodeURIComponent(g.q),delete g.options.property,delete g.options.strict;var h=f.set_params(g.options),i=b.host+"search/?"+h;("/type/type"==g.options.type||"/type/property"==g.options.type)&&(i+="&scoring=schema&stemmed=true"),f.http(i,g.options,function(a){return a&&a.result&&a.result[0]?g.callback(a.result):g.callback([])})},a.url_lookup=function(){this.doc="freebase search tuned for looking up a url",this.reference="http://wiki.freebase.com/wiki/ApiSearch";var g=f.settle_params(arguments,a.url_lookup,{type:"/common/topic",strict:!0});if(g.array)return f.doit_async(g);if(!g.valid)return g.callback({});var h=f.clone(b.generic_query),i=b.host+"search?type=/common/topic&limit=1&query="+encodeURIComponent(g.q);i+="&mql_output="+encodeURIComponent(JSON.stringify(h)),f.http(i,g.options,function(a){if(!a||!a.result)return g.callback({});var b=a.result||[];return g.callback(b[0])})},a.lookup=function(){this.doc="freebase search with filters to ensure only a confident, unambiguous result",this.reference="http://wiki.freebase.com/wiki/ApiSearch";var h=f.settle_params(arguments,a.lookup,{type:"/common/topic",strict:!0});if(h.array)return f.doit_async(h);if(!h.valid)return h.callback({});if(h.url)return a.url_lookup(h.q,h.options,h.callback);if(h.is_id)return h.options.limit=1,a.lookup_id(h.q,h.options,h.callback);var i=h.options.strength||"full";h.options.strict||(i="word");var j=b.host+"search?limit=2&lang=en&type="+h.options.type+"&filter=",k=f.clone(b.generic_query);return j+=encodeURIComponent("(any name{"+i+'}:"'+h.q+'" alias{'+i+'}:"'+h.q+'")'),("/type/type"==h.options.type||"/type/property"==h.options.type)&&(j+="&scoring=schema&stemmed=true"),j+="&mql_output="+encodeURIComponent(JSON.stringify(k)),f.http(j,h.options,function(a){return a&&a.result&&a.result[0]?(a=a.result||[],a[0]=a[0]||{},a[1]=a[1]||{},!a[0].score&&a[0].score<30?h.callback({}):h.options.strict&&.7*(a[0].score||0)<(a[1].score||0)?h.callback({}):a[1]&&a[0].notable&&f.isin(a[0].notable.id,c.kill)?h.callback({}):(a[0].name=a[0].name||a[0].text||"",h.callback(a[0]))):h.callback({})})},a.get_id=function(){this.doc="like freebase.lookup but satisfied with an id",this.reference="http://wiki.freebase.com/wiki/ApiSearch";var e=f.settle_params(arguments,a.get_id,{type:"/common/topic"});return e.array?f.doit_async(e):e.valid?e.q&&null==e.q.match(/\/.{1,32}\/.{3}/)?(a.lookup(e.q,e.options,function(a){return a?"/type/type"==e.options.type?(a.mid=a.id,e.callback(a)):a.mid?(a.id=a.id||a.mid,e.callback(a)):e.callback({}):e.callback({})}),void 0):e.callback({id:e.q}):e.callback({})},a.topic=function(){this.doc="topic api",this.reference="http://wiki.freebase.com/wiki/Topic_API";var g=f.settle_params(arguments,a.topic,{});return g.array?f.doit_async(g):g.valid?(a.get_id(g.q,g.options,function(a){var c=a.id;if(!c)return g.callback({});g.options.filter=g.options.filter||"all";var d=b.host+"topic"+c+"?"+f.set_params(g.options);f.http(d,g.options,function(a){return g.callback(a)})}),void 0):g.callback({})},a.paginate=function(b,c,d){this.doc="get all of the results to your query",this.reference="http://wiki.freebase.com/wiki/MQL","function"==typeof c&&(d=c,c={}),c=c||{},d=d||console.log,c.max=c.max||99999999;var e=[],f=function(g){c.cursor=g||"",a.mqlread(b,c,function(a){return a&&a.result?(e=e.concat(a.result),a.cursor&&(!c.max||e.length<c.max)?(f(a.cursor),void 0):d(e)):d(e)})};f("")},a.description=function(){this.doc="get a text blurb from freebase",this.reference="http://wiki.freebase.com/wiki/ApiText";var g=f.settle_params(arguments,a.description,{});return g.array?f.doit_async(g):g.valid?(a.get_id(g.q,g.options,function(a){if(!a||!a.id)return g.callback("");var c=b.host+"text/"+a.id;f.http(c,g.options,function(a){return a.result?g.callback(a.result):g.callback("")})}),void 0):g.callback({})},a.image=function(){this.doc="get a url for image href of on this topic",this.reference="http://wiki.freebase.com/wiki/ApiImage";var g=f.settle_params(arguments,a.image,{maxheight:250,maxwidth:250,errorid:"/m/0djw4wd"});return g.array?f.doit_async(g):g.valid?(a.get_id(g.q,g.options,function(c){if(!c||!c.id)return g.callback("");var d=[{id:c.id,name:null,"/common/topic/image":[{id:null}]}];a.mqlread(d,g.options,function(a){if(!(a&&a.result&&a.result[0]&&a.result[0]["/common/topic/image"][0]))return g.callback("");var c=b.image_host+a.result[0]["/common/topic/image"][0].id;delete g.options.strict,delete g.options.cursor,delete g.options.uniqueness_failure;var d=f.set_params(g.options);return c+="?"+d,g.callback(c)})}),void 0):g.callback({})},a.grammar=function(b,e){this.doc="get the proper pronoun to use for a topic eg. he/she/they/it";var h=f.settle_params(arguments,a.grammar,{});return h.array?f.doit_async(h):h.valid?(a.get_id(h.q,h.options,function(b){if(!b||!b.id)return h.callback({});var g=[{id:b.id,name:null,type:[],"/people/person/gender":[{id:null,optional:!0}],"/fictional_universe/fictional_character/gender":[{id:null,optional:!0}]}];a.mqlread(g,e,function(a){if(!a||!a.result||!a.result[0])return h.callback({});a=a.result[0];var b={plural:!1,gender:null,article:"a",pronoun:"it",copula:"is"};if(f.isin("/people/person",a.type)||f.isin("/fictional_universe/fictional_character",a.type)){var e=a["/people/person/gender"][0]||a["/fictional_universe/fictional_character/gender"][0];e?"/en/male"==e.id?(b.gender="male",b.pronoun="he"):"/en/female"==e.id&&(b.gender="female",b.pronoun="she"):(b.gender="unknown",b.pronoun="they")}else d.intersection(c.plural_types,a.type).length>0&&(b.plural=!0,b.pronoun="they",b.copula="are"),d.intersection(c.definate_articles,a.type).length>0&&(b.article="the");return h.callback(b)})}),void 0):h.callback({})},a.same_as_links=function(){this.doc="turns a url into a freebase topic and list its same:as links";var h=f.settle_params(arguments,a.same_as_links,{});if(h.array)return f.doit_async(h);if(!h.valid)return h.callback({});var i=b.host+"search?type=/common/topic&limit=1&query="+encodeURIComponent(h.q);f.http(i,h.options,function(b){return b&&b.result&&b.result[0]?(a.topic(b.result[0].mid,h.options,function(a){if(d.isEmpty(a))return h.callback([]);var c=[];a.property["/common/topic/topic_equivalent_webpage"]&&(c=a.property["/common/topic/topic_equivalent_webpage"].values.map(function(a){return{href:a.value,title:f.parseurl(a.value).authority}})),a.property["/common/topic/topical_webpage"]&&(c=c.concat(a.property["/common/topic/topical_webpage"].values.map(function(a){var b=f.parseurl(a.value).authority||"";return{href:a.value,title:b.replace(/^www\./,"")}})));var e={topic:b.result[0],links:c};return h.callback(e)}),void 0):h.callback({})})},a.translate=function(){this.doc="return specific language title for a topic",this.reference="http://wiki.freebase.com/wiki/I18n";var e=f.settle_params(arguments,a.translate,{lang:"/lang/fr"});return e.array?f.doit_async(e):e.valid?(e.options.lang.match(/\/lang\//)||(e.options.lang="/lang/"+e.options.lang),a.get_id(e.q,e.options,function(b){if(!b||!b.id)return e.callback("");var c=[{id:b.id,name:[{lang:e.options.lang,value:null}]}];a.mqlread(c,{},function(a){if(!a||!a.result||!a.result[0])return e.callback("");var b=a.result[0].name||[{}];return b=b[0].value||"",e.callback(b)})}),void 0):e.callback({})},a.notable=function(){this.doc="get a topic's notable type";var e=f.settle_params(arguments,a.notable,{});return e.array?f.doit_async(e):e.valid?(a.topic(e.q,{filter:"/common/topic/notable_types"},function(a){if(!a||!a.property||!a.property["/common/topic/notable_types"])return e.callback({});var b=a.property["/common/topic/notable_types"]||{values:[]};return b.values[0].name=b.values[0].text,e.callback(b.values[0])}),void 0):e.callback({})},a.sentence=function(){this.doc="get the first sentence of a topic description",this.reference="http://wiki.freebase.com/wiki/APIText";var e=f.settle_params(arguments,a.sentence,{});return e.array?f.doit_async(e):e.valid?(a.description(e.q,e.options,function(a){return a?(a=f.sentenceparser(a)||[],a=a[0]||"",a=a.replace(/\(.*?\)/g,""),a=a.replace(/  /g," "),e.callback(a)):e.callback("")}),void 0):e.callback({})},a.list=function(){this.doc="get a list of topics in a type";var e=f.settle_params(arguments,a.list,{limit:2e3});return e.array?f.doit_async(e):e.valid?(e.q.match(/\/.{1,12}\/.{3}/)||(e.q=f.singularize(e.q)),a.get_id(e.q,{type:"/type/type"},function(b){if(!b||!b.id)return e.callback([]);var c=[{type:b.id,name:null,id:null,mid:null,limit:100}];if(e.options.extend)for(var d in e.options.extend)c[0][d]=e.options.extend[d];a.paginate(c,e.options,e.callback)}),void 0):e.callback([])},a.place_data=function(c,d,e){if(this.doc="from a geo-coordinate and area radius (in feet), get the town, province, country, and timezone for it",e=e||console.log,!c)return e({});if(d=d||{},f.isarray(c)&&c.length>1){var g=f.settle_params(arguments,a.place_data,{});return f.doit_async(g)}({coordinates:[c.lng,c.lat],type:"Point"}),c.radius=c.radius||999e3;var j="(all type:/location/citytown (within radius:"+c.radius+"ft lon:"+c.lng+" lat:"+c.lat+"))",k=b.host+"search?filter="+j+"&limit=200";f.http(k,d,function(b){var c={city:null,country:null,province:null,timezone:null};c.city=b.result[0];var d=[{name:null,id:b.result[0].mid,"/location/location/containedby":[{id:null,name:null,type:[],optional:!0,"/location/location/time_zones":[{"/time/time_zone/offset_from_uct":null,id:null,name:null,optional:!0}],"/location/location/containedby":[{id:null,name:null,type:[],optional:!0,"/location/location/time_zones":[{"/time/time_zone/offset_from_uct":null,id:null,name:null,optional:!0}]}]}]}];a.mqlread(d,{},function(a){for(var b in a.result[0]["/location/location/containedby"]){var d=a.result[0]["/location/location/containedby"][b];if(d.type.filter(function(a){return"/location/country"==a})[0]?c.country={id:d.id,name:d.name}:d.type.filter(function(a){return"/location/administrative_division"==a})[0]&&(c.province={id:d.id,name:d.name}),d["/location/location/time_zones"][0]&&1==d["/location/location/time_zones"].length&&(c.timezone=d["/location/location/time_zones"][0]),c.country)return e(c);d["/location/location/containedby"].map(function(a){a.type.filter(function(a){return"/location/country"==a})[0]?c.country={id:a.id,name:a.name}:!c.province&&a.type.filter(function(a){return"/location/administrative_division"==a})[0]&&(c.province={id:a.id,name:a.name}),!c.timezone&&a["/location/location/time_zones"][0]&&1==a["/location/location/time_zones"].length&&(c.timezone=a["/location/location/time_zones"][0])})}return e(c)})})},a.incoming=function(){this.doc="get any incoming data to this topic, ignoring cvt types";var e=f.settle_params(arguments,a.incoming,{});return e.array?f.doit_async(e):e.valid?(a.get_id(e.q,e.options,function(b){if(!b||!b.id)return e.callback([]);var c=[{id:b.id,"/type/reflect/any_reverse":[{link:null,id:null,name:null,type:"/common/topic",limit:170}]}];a.paginate(c,e.options,function(a){return a&&a[0]&&a[0]["/type/reflect/any_reverse"]?e.callback(a[0]["/type/reflect/any_reverse"]):e.callback([])})}),void 0):e.callback({})},a.outgoing=function(){this.doc="return all outgoing links for a topic, traversing cvt types";var h=f.settle_params(arguments,a.outgoing,{});return h.array?f.doit_async(h):h.valid?(a.lookup(h.q,h.options,function(b){return b&&b.mid?(a.topic(b.mid,h.options,function(a){if(d.isEmpty(a))return h.callback([]);var e=[];return a.property=f.kill_boring(a.property),Object.keys(a.property).forEach(function(b){var c=a.property[b];"object"==c.valuetype&&(c.values=c.values.map(function(a){return a.property=b,a}),e=e.concat(c.values)),"compound"==c.valuetype&&c.values.forEach(function(a){a.property=f.kill_boring(a.property),Object.keys(a.property).forEach(function(c){"object"==a.property[c].valuetype&&(a.property[c].values=a.property[c].values.map(function(a){return a.property=[b,c],a}),e=e.concat(a.property[c].values))})})}),e=e.map(function(a){return{name:a.text,id:a.id,property:a.property}}),e=e.map(function(a){var e=a.property||"";f.isarray(a.property)&&(e=a.property.join("")),a.sentence=b.name+"'s "+d.last(e.split("/")).replace("_"," ")+" is "+a.name;var g=c.sentence_grammars.filter(function(a){return a.id==e})[0]||{};return g.sen&&b.name&&a.name&&(a.sentence=g.sen.replace(/\bsubj\b/,b.name).replace(/\bobj\b/,a.name)),a}),h.callback(e)}),void 0):h.callback([])}),void 0):h.callback({})},a.graph=function(){this.doc="return all outgoing and incoming links for a topic";var h=f.settle_params(arguments,a.graph,{});return h.array?f.doit_async(h):h.valid?(a.lookup(h.q,h.options,function(b){return b?(delete b.score,delete b.lang,h.options.filter="allproperties",a.topic(b.mid,h.options,function(a){if(!a||!a.property)return h.callback([]);var e={},g={};Object.keys(a.property).forEach(function(b){b.match(/^\!/)?g[b]=a.property[b]:e[b]=a.property[b]}),e=f.parse_topic_api(e),g=f.parse_topic_api(g);var i=e.map(function(a){return{subject:b,property:{id:a.property},object:a,direction:"outgoing"}});return i=i.concat(g.map(function(a){return{object:b,property:{id:a.property},subject:a,direction:"incoming"}})),i=i.map(function(a){a.property.id=a.property.id.replace(/^\!/,""),delete a.subject.property;var b=c.sentence_grammars.filter(function(b){return b.id==a.property.id})[0]||{};return a.sentence=a.subject.name+"'s "+d.last(a.property.id.split("/")).replace("_"," ")+" is "+a.object.name,b.sen&&a.subject.name&&a.object.name&&(a.sentence=b.sen.replace(/\bsubj\b/,a.subject.name).replace(/\bobj\b/,a.object.name)),a}),h.callback(i)}),void 0):h.callback({})}),void 0):h.callback({})},a.related=function(b,e){this.doc="get similar topics to a topic";var h=f.settle_params(arguments,a.related,{});if(h.array)return f.doit_async(h);if(!h.valid)return h.callback({});var i=[];a.outgoing(h.q,h.options,function(b){return i=b.filter(function(a){return f.isin(a.property,c.related_properties)}),i=i.sort(function(){return Math.round(Math.random())-.5}),i=i.map(function(a){return a.sentence||(a.sentence=a.name+" is related to "+b.name),a}),i=f.json_unique(i,"id"),i.length>=e.max?h.callback(i):(a.notable(h.q,h.options,function(b){return b&&b.id?a.list(b.id,{max:h.options.max},function(a){return!a||d.isEmpty(a)?h.callback(i):(a=a.map(function(a){return a.sentence=a.name+" is also a "+b.name,a}),i=i.concat(a),i=f.json_unique(i,"id"),i=i.sort(function(){return Math.round(Math.random())-.5}),h.callback(i))}):h.callback(i)}),void 0)})},a.is_a=function(){this.doc="get a list of identifiers for a topic";var h=f.settle_params(arguments,a.related,{max:25});return h.array?f.doit_async(h):h.valid?(a.topic(h.q,h.options,function(a){if(d.isEmpty(a))return h.callback({});var b=a.property["/type/object/type"]||{};return b=b.values||[],b=b.filter(function(a){return!a.text.match(/Topic/)}),b=b.map(function(a){return{name:a.text,id:a.id,property:"/type/object/type"}}),a=f.parse_topic_api(a.property),a=a.filter(function(a){return f.isin(a.property,c.is_a)}),a=a.concat(b),h.callback(a)}),void 0):h.callback({})},a.property_lookup=function(b){this.doc="lookup soft property matches, like 'birthday' vs 'date of birth'";var g=f.settle_params(arguments,a.property_lookup,{type:"/type/property"});return g.array?f.doit_async(g):g.valid?(a.search(g.q,g.options,function(a){if(!b.match(/\/.*?\/.*?\//)){b=b.toLowerCase(),b=b.replace(/  /," "),b=b.replace(/^\s+|\s+$/,"");var d=f.singularize(b);a=a.concat(c.properties.filter(function(a){return a.n==b||a.n==d}))}return g.callback(a)}),void 0):g.callback({})},a.question=function(b,c){this.doc="give a topic and a property, and get a list of results";var g=f.settle_params(arguments,a.question,{max:25});if(g.array)return f.doit_async(g);if(!g.valid||!g.options.property)return g.callback({});var h=g.options.property,i=g.options.property.match(/\/.*?\/.*?\//);if(h.match(/^\/.{1,12}\/.{3}/))return a.topic(b,{},function(a){return a&&a.property&&a.property[h]?g.callback(a.property[h].values):g.callback([])});var j=f.metaschema_lookup(h);j?(g.options.filter="(all "+j+':"'+b+'")',a.search("",c,function(a){return g.callback(a)})):a.property_lookup(h,{},function(b){return 0===b.length?g.callback([]):(g.options.filter=i,a.topic(g.q,g.options,function(a){if(d.isEmpty(a))return g.callback({});var c=[];return b.forEach(function(b){a.property[b.id]&&(c=c.concat(a.property[b.id].values))}),c=f.json_unique(c,"id"),g.callback(c)}),void 0)})},a.dig=function(b,c,e){this.doc="transitive query on a specific property, maximum 3-ply";var g=f.settle_params(arguments,a.property_lookup,{max:25});if(g.array)return f.doit_async(g);if(!g.valid)return g.callback({});var h=[];a.question(g.q,g.options,function(b){return b&&f.isarray(b)&&0!==b.length?(h=h.concat(b),b=b.slice(0,g.options.max).map(function(a){return a.id}),f.doit_async({q:b,options:g.options,method:a.question,callback:function(c){return c&&f.isarray(c)&&0!==c.length?(h=h.concat(d.flatten(c,"shallow")),h=f.json_unique(h,"id"),obj={q:b,options:g.options,method:a.question,callback:function(a){return a&&f.isarray(a)&&0!==a.length?(h=h.concat(d.flatten(a,"shallow")),h=f.json_unique(h,"id"),e(h)):g.callback(h)}},f.doit_async(obj),void 0):g.callback(h)}})):g.callback(h)})},a.gallery=function(){this.doc="list of topics with images";var h=f.settle_params(arguments,a.gallery,{extend:{"/common/topic/image":[{id:null,optional:"required"}]}});return h.array?f.doit_async(h):h.valid?(a.list(h.q,h.options,function(c){return c=c.map(function(c){return c.href=b.image_host+d.last(c["/common/topic/image"]).id,c.thumbnail=b.image_host+d.last(c["/common/topic/image"]).id+"?mode=fillcropmid&maxwidth=150&maxheight=150&errorid=/m/0djw4wd",c=a.add_widget(c)}),h.callback(c)}),void 0):h.callback({})},a.wordnet=function(){this.doc="query wordnet via freebase";var e=f.settle_params(arguments,a.wordnet,{});if(e.array)return f.doit_async(e);if(!e.valid)return e.callback({});var g=[{id:null,type:"/base/wordnet/synset",gloss:null,syntactic_category:null,sort:["syntactic_category","word.sense_number","a:word.word_number"],word:{sense_number:null,derivationally_related_forms:[{sense:{name:null,id:null},optional:!0}],word:{word:e.q}},"a:word":[{word_number:null,word:{word:null}}]}];e.options.limit&&(g[0].limit=e.options.limit),a.mqlread(g,e.options,function(a){return e.callback(a.result)})},a.transitive=function(){this.doc="do a transitive-query, like all rivers in canada, using freebase metaschema";var e=f.settle_params(arguments,a.transitive,{});return e.array?f.doit_async(e):e.valid?(a.get_id(e.q,e.options,function(b){if(!b||!b.id)return e.callback({});var c=f.metaschema_lookup(e.options.property);return c?(e.options.filter="(all "+c+':"'+b.mid+'")',a.search("",e.options,function(a){return e.callback(a)}),void 0):e.callback([])}),void 0):e.callback({})},a.geolocation=function(){this.doc="lat/long for a topic";var e=f.settle_params(arguments,a.geolocation,{type:"/location/location"});return e.array?f.doit_async(e):e.valid?(a.get_id(e.q,e.options,function(b){if(!b||!b.id)return e.callback({});var c=[{id:b.id,name:null,"/location/location/geolocation":[{latitude:null,longitude:null,type:"/location/geocode",optional:!0}]}];a.mqlread(c,e.options,function(a){if(a.result&&a.result[0]&&a.result[0]["/location/location/geolocation"][0]){var b=a.result[0]["/location/location/geolocation"][0];return delete b.type,delete b.optional,e.callback(b)}return e.callback({})})}),void 0):e.callback({})},a.nearby=function(){this.doc="list of topics nearby a location";var g=f.settle_params(arguments,a.nearby,{});return g.array?f.doit_async(g):g.valid?(a.geolocation(g.q,{},function(a){if(!a||!a.latitude||!a.longitude)return g.callback([]);g.options.within=g.options.within||500,g.options.type=g.options.type||"/location/location";var c="(all type:"+g.options.type+" (within radius:"+g.options.within+"ft lon:"+a.longitude+" lat:"+a.latitude+"))",d=b.host+"search?filter="+encodeURIComponent(c)+"&limit=200";f.http(d,g.options,function(a){return g.callback(a.result)})}),void 0):g.callback({})},a.inside=function(){this.doc="list of topics inside a location";var e=f.settle_params(arguments,a.inside,{property:"part_of"});return e.array?f.doit_async(e):e.valid?(e.options.mql_output=e.options.mql_output||[{name:null,id:null,type:"/location/location","/location/location/geolocation":[{latitude:null,longitude:null,type:"/location/geocode",optional:!0}]}],a.transitive(e.q,e.options,function(a){return e.callback(a)}),void 0):e.callback({})},a.wikipedia_page=function(){this.doc="get a url for wikipedia based on this topic";var e=f.settle_params(arguments,a.wikipedia,{});return e.array?f.doit_async(e):e.valid?(a.get_id(e.q,e.options,function(b){if(!b||!b.id)return e.callback("");var c=[{id:b.id,name:null,key:{namespace:"/wikipedia/en_title",value:null}}];a.mqlread(c,e.options,function(a){return a&&a.result&&a.result[0]?e.callback("http://en.wikipedia.org/wiki/"+f.mql_unencode(a.result[0].key.value)):e.callback("")})}),void 0):e.callback({})},a.dbpedia_page=function(){this.doc="get a url for dbpedia based on this topic";var e=f.settle_params(arguments,a.dbpedia,{});return e.array?f.doit_async(e):e.valid?(a.get_id(e.q,e.options,function(b){if(!b||!b.id)return e.callback("");var c=[{id:b.id,name:null,key:{namespace:"/wikipedia/en_title",value:null}}];a.mqlread(c,e.options,function(a){if(!a||!a.result||!a.result[0])return e.callback({});var b=f.mql_unencode(a.result[0].key.value),c={html:"http://dbpedia.org/page/"+b,json:"http://dbpedia.org/data/"+b+".json"};return e.callback(c)})}),void 0):e.callback({})},a.wikipedia_categories=function(){this.doc="get the wikipedia categories for a topic";var g=f.settle_params(arguments,a.wikipedia_categories,{});if(g.array)return f.doit_async(g);if(!g.valid)return g.callback({});var h=b.wikipedia_host+"?action=query&prop=categories&format=json&clshow=!hidden&cllimit=200&titles="+encodeURIComponent(g.q);f.http(h,g.options,function(a){if(!(a&&a.query&&a.query.pages&&a.query.pages[Object.keys(a.query.pages)[0]]))return g.callback([]);var b=a.query.pages[Object.keys(a.query.pages)[0]].categories||[];return b=b.map(function(a){return a.title}),g.callback(b)})},a.wikipedia_links=function(c,d,e){this.doc="outgoing links from this wikipedia page, converted to freebase ids",e=e||console.log;var g=f.settle_params(arguments,a.wikipedia_links,{});if(!c)return e({});if("function"==typeof d&&(e=d,d={}),d=d||{},f.isarray(c)&&c.length>1){var g=f.settle_params(arguments,a.wikipedia_links,{});return f.doit_async(g)}if(c.match(/ /)||c.substr(0,1)==c.substr(0,1).toLowerCase()||c.match(/^\//))return a.wikipedia_page(c,d,function(b){a.wikipedia_links(b,d,e)});var h=b.wikipedia_host+"?action=query&prop=links&format=json&plnamespace=0&pllimit=500&titles="+encodeURIComponent(c);f.http(h,g.options,function(b){if(!(b&&b.query&&b.query.pages&&b.query.pages[Object.keys(b.query.pages)[0]]))return e([]);var c=b.query.pages[Object.keys(b.query.pages)[0]].links||[];return c=c.filter(function(a){return null==a.title.match(/^List of /i)}),c=c.map(function(b){return b.id="/wikipedia/en/"+a.mql_encode(b.title.replace(/ /g,"_")),b.name=b.title,delete b.title,delete b.ns,b}),e(c)})},a.wikipedia_external_links=function(c,d,e){this.doc="outgoing links from this wikipedia page, converted to freebase ids",e=e||console.log;var g=f.settle_params(arguments,a.wikipedia_external_links,{});if(!c)return e({});if("function"==typeof d&&(e=d,d={}),d=d||{},f.isarray(c)&&c.length>1){var g=f.settle_params(arguments,a.wikipedia_external_links,{});return f.doit_async(g)}if(c.match(/ /)||c.substr(0,1)==c.substr(0,1).toLowerCase()||c.match(/^\//))return a.wikipedia_page(c,d,function(b){a.wikipedia_external_links(b,d,e)});var h=b.wikipedia_host+"?action=query&prop=extlinks&format=json&ellimit=500&titles="+encodeURIComponent(c);f.http(h,g.options,function(a){if(!(a&&a.query&&a.query.pages&&a.query.pages[Object.keys(a.query.pages)[0]]))return e([]);var b=a.query.pages[Object.keys(a.query.pages)[0]].extlinks||[];return b=b.filter(function(a){return a["*"].match(/^http/)}),b=b.map(function(a){var b=f.parseurl(a["*"]);return{url:a["*"],domain:b.host}}),e(b)})},a.property_introspection=function(b,c,d){if(this.doc="common lookups for freebase property data",d=d||console.log,!b)return d({});"function"==typeof c&&(d=c,c={}),c=c||{};var e=f.settle_params(arguments,a.property_introspection);if(f.isarray(b)&&b.length>1)return f.doit_async(e);var g=[{id:b,mid:null,name:null,type:"/type/property",reverse_property:[{id:null,name:null,optional:!0}],expected_type:[{id:null,name:null,optional:!0,"/freebase/type_hints/mediator":null}],unique:null,schema:{id:null,name:null,"/freebase/type_profile/instance_count":null,"/freebase/type_hints/mediator":null},"/common/topic/description":null}];a.mqlread(g,c,function(e){var f={};if(!e||!e.result||!e.result[0])return d(f);e=e.result[0],f.name=e.name,f.id=e.id,f.type=e.schema,f.description=e["/common/topic/description"],f.unique=e.unique||!1,f.reverse_property=e.reverse_property,f.expected_type=e.expected_type;var g=[{name:null,type:"/base/fbontology/semantic_predicate",paths:{"a:properties":b,"b:properties":[{id:null}]}}];a.mqlread(g,c,function(a){return f.meta=a.result,d(f)})})},a.schema=function(b,c,d){if(this.doc="common lookups for types and properties",d=d||console.log,!b)return d({});if("function"==typeof c&&(d=c,c={}),c=c||{},f.isarray(b)&&b.length>1){var e=f.settle_params(arguments,a.schema,{});return f.doit_async(e)}c.type="/type/type",a.search(b,c,function(e){if(e&&e[0]&&e[0].id){e=e[0];var f=[{id:e.id,mid:null,name:null,properties:[{id:null,name:null,optional:!0,"/type/property/reverse_property":[{id:null,name:null,optional:!0}]}],"/freebase/type_hints/mediator":null,"/freebase/type_hints/included_types":[{id:null,name:null,optional:!0}],"/freebase/type_profile/published":null,"/type/type/expected_by":[{id:null,name:null,optional:!0}],"/freebase/type_profile/instance_count":null,"/freebase/type_profile/property_count":null,domain:{id:null,name:null},"/freebase/type_profile/equivalent_topic":[{id:null,name:null,optional:!0}],type:"/type/type"}];a.mqlread(f,c,function(b){if(!b||!b.result||!b.result[0])return d({});b=b.result[0];var e={};e.domain=b.domain,e.id=b.id,e.name=b.name,e.included_types=b["/freebase/type_hints/included_types"],e.incoming_properties=b["/type/type/expected_by"],e.is_compound_value=b["/freebase/type_hints/mediator"]||!1,e.is_commons=b["/freebase/type_profile/published"]||!1,e.equivalent_topic=b["/freebase/type_profile/equivalent_topic"],e.topic_count=b["/freebase/type_profile/instance_count"]||0,e.property_count=b["/freebase/type_profile/property_count"]||0;var f=[{id:null,name:null,"s:name":{value:null,lang:"/lang/en",optional:"required"},"/freebase/type_hints/included_types":[{id:e.id}]}];
a.mqlread(f,c,function(a){return a&&a.result?(e.included_by=a.result.map(function(a){return{id:a.id,name:a.name}}),d(e)):d(e)})})}else a.property_lookup(b,c,function(b){return b&&b[0]&&b[0].id?a.property_introspection(b[0].id,{},d):d({})})})},a.drilldown=function(b,c){this.doc="get insight into the breakdown of the topics in this type, by type and quality";var g=f.settle_params(arguments,a.drilldown,{limit:1e3});return g.array?f.doit_async(g):g.valid?(g.q.match(/\/.{1,12}\/.{3}/)||(g.q=f.singularize(g.q)),a.get_id(g.q,{type:"/type/type"},function(b){if(!b||!b.id)return g.callback([]);var e=[{"s:type":b.id,type:[],name:null,id:null,limit:150,"estimate-count":null,"/common/topic/image":[{id:null,limit:1,optional:!0}],key:[{namespace:"/wikipedia/en",limit:1,value:null,optional:!0}],"/common/topic/alias":[{value:null,limit:1,optional:!0}]}];if(c.extend)for(var h in c.extend)e[0][h]=c.extend[h];a.paginate(e,g.options,function(a){var b=d.flatten(a.map(function(a){return a.type}));b=b.filter(function(a){return!a.match(/\/topic$/)});var c=f.topk(b,a.length),e=a.filter(function(a){return a["/common/topic/alias"].length>0}),h=a.filter(function(a){return a["/common/topic/image"].length>0}),i=a.filter(function(a){return a.key.length>0}),j={types:c,alias_percent:f.percentage(e.length,a.length),image_percent:f.percentage(h.length,a.length),wikipedia_percent:f.percentage(i.length,a.length),subset:a.length,"estimate-count":a[0]["estimate-count"]};g.callback(j)})}),void 0):g.callback([])},a.mql_encode=function(a){if(this.doc="quote a unicode string to turn it into a valid mql /type/key/value",!a)return"";a=a.replace(/  /," "),a=a.replace(/^\s+|\s+$/,""),a=a.replace(/ /g,"_");var b="A-Za-z0-9",c="A-Za-z0-9_-",d=new RegExp("^["+b+"]["+c+"]*$"),e=new RegExp("([^"+c+"])","g");if(d.exec(a))return a;var f=function(a,b){var c=b.charCodeAt(0).toString(16).toUpperCase();return 2==c.length&&(c="00"+c),3==c.length&&(c="0"+c),"$"+c},g=a.replace(e,f);return("-"==g.charAt(0)||"_"==g.charAt(0))&&(g=f(g,g.charAt(0))+g.substr(1)),g},a.category_list=function(){function j(c,d){var e=b.wikipedia_host+"?action=query&list=categorymembers&format=json&cmlimit=400&cmtitle="+encodeURIComponent(c)+"&cmcontinue="+d;f.http(e,g.options,function(b){if(!(b&&b.query&&b.query.categorymembers&&b.query.categorymembers[Object.keys(b.query.categorymembers)[0]]))return g.callback([]);i=i.concat(b.query.categorymembers.filter(function(a){return 14==a.ns}));var d=b["query-continue"]||{};d=d.categorymembers||{},d=d.cmcontinue||"";var e=b.query.categorymembers.filter(function(a){return 0==a.ns});return e=e.map(function(b){return{id:"/wikipedia/en/"+a.mql_encode(b.title),article:"http://en.wikipedia.org/wiki/index.html?curid="+b.pageid,title:b.title}}),h=h.concat(e),d?(j(c,d),void 0):g.callback(h)})}this.doc="get the freebase topics in a wikipedia category";var g=f.settle_params(arguments,a.category_list,{depth:1});if(g.array)return f.doit_async(g);if(!g.valid)return g.callback({});g.q.match(/Category:/)||(g.q="Category:"+g.q);var h=[],i=[];j(g.q,"")},a.wikipedia_subcategories=function(){this.doc="find the subcategories of this wikipedia category";var h=f.settle_params(arguments,a.wikipedia_subcategories,{depth:1,already:[]});if(h.array)return f.doit_async(h);if(!h.valid)return h.callback({});h.q.match(/Category:/)||(h.q="Category:"+h.q);var i=b.wikipedia_host+"?action=query&list=categorymembers&format=json&cmlimit=400&cmnamespace=14&cmtitle="+encodeURIComponent(h.q);f.http(i,h.options,function(b){if(!(b&&b.query&&b.query.categorymembers&&b.query.categorymembers[Object.keys(b.query.categorymembers)[0]]))return h.callback([]);var c=b.query.categorymembers.map(function(a){return a.title});return c=c.filter(function(a){return!f.isin(a,h.options.already)}),h.options.already=f.compact_strong(d.flatten(h.options.already.concat(c))),h.options.depth>1&&c.length>0?(h.options.depth=h.options.depth-1,a.wikipedia_subcategories(c,h.options,function(a){return h.options.already=h.options.already.concat(a),h.callback(f.compact_strong(d.flatten(h.options.already)))})):h.callback(h.options.already)})},a.rdf=function(){this.doc="RDF api",this.reference="http://wiki.freebase.com/wiki/RDF";var g=f.settle_params(arguments,a.topic,{});return g.array?f.doit_async(g):g.valid?(a.get_id(g.q,g.options,function(a){var c=a.id;if(!c)return g.callback({});g.options.filter=g.options.filter||"all";var d=b.host+"rdf"+c;f.softget(d,g.options,function(a){return g.callback(a||"")})}),void 0):g.callback({})},a.wikipedia_to_freebase=function(){this.doc="turn a wikipedia title or url into a freebase topic";var e=f.settle_params(arguments,a.wikipedia_to_freebase,{depth:1});if(e.array)return f.doit_async(e);if(!e.valid)return e.callback({});e.q=e.q.replace(/^https?:\/\/..\.wikipedia\.org\/wiki\//,"");var g=e.q,h={id:"/wikipedia/en/"+a.mql_encode(e.q),title:g};return e.callback(h)},a.add_widget=function(a){if(this.doc="add a generic html view of a topic",!a||!c)return a;var c=a.mid||a.id,d='<a href="#" class="imagewrap" data-id="'+c+'" style="position:relative; width:200px; height:200px;">'+'<img style="border-radius:5px;" src="'+b.image_host+c+'?maxwidth=200&maxheight=200&errorid=/m/0djw4wd"/>';return a.name&&(d+='<div class="caption" style="position:absolute; opacity:0.5; background:black; bottom:10px; color:white; left:10px; border-radius: 5px; min-width:100px; padding:5px;">'+a.name+"</div>"),d+="</a>",a.widget=d,a},a.mqlwrite=function(c,d,e){if(this.doc="write to freebase",this.reference="http://wiki.freebase.com/wiki/MQLwrite",e=e||console.log,!c)return e({});"function"==typeof d&&(e=d,d={}),d=d||{},d.oauth_token=d.token||d.oauth_token||a.access_token,d.oauth_token||(console.log("========="),console.log("to write to freebase, you must create an 'access token'"),console.log("create one by running 'node ./mqlwrite/create_access_token' and following the instructions"),console.log("========="));var g=b.host+"mqlwrite?query="+encodeURIComponent(JSON.stringify(c))+"&oauth_token="+(d.oauth_token||"");f.http(g,e)},a.add_type=function(b,c,d){this.doc="add a type to a freebase topic",this.reference="http://wiki.freebase.com/wiki/MQLwrite",d=d||console.log,c=c||{};var e={id:b,type:{id:c.type,connect:"insert"}};a.mqlwrite(e,c,d)},a.add_alias=function(b,c,d){this.doc="add a alias to a freebase topic",this.reference="http://wiki.freebase.com/wiki/MQLwrite",d=d||console.log,c=c||{};var e={id:b,"/common/topic/alias":{value:c.alias,connect:"insert",lang:"/lang/en"}};a.mqlwrite(e,c,d)},a.test_writes=function(b){a.add_type("/en/radiohead",{type:"/music/artist",token:b})},a.documentation=function(){Object.keys(a).filter(function(a){return"documentation"!=a&&"access_token"!=a&&"test_writes"!=a}).forEach(function(b){x=new a[b]("",{},function(){}),console.log("* **"+b+"**\n     -"+x.doc)})},"undefined"!=typeof define&&define.amd?define([],function(){return a}):"undefined"!=typeof module&&module.exports&&(module.exports=a),a}();return g}()}(jQuery);