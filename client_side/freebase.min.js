var data=function(){var a={};return a.properties={alias:"/common/topic/alias",type:"/type/object/type",name:"/type/object/name",id:"/type/object/id",mid:"/type/object/mid",key:"/type/object/key"},a.is_a=["/amusement_parks/ride/ride_type","/amusement_parks/roller_coaster/propulsion","/amusement_parks/roller_coaster/train_configuration","/architecture/building/building_function","/architecture/museum/type_of_museum","/astronomy/asteroid/spectral_type","/astronomy/celestial_object/category","/astronomy/extraterrestrial_location/type_of_planetographic_feature","/astronomy/galaxy/galaxy_classification_hubble","/astronomy/galaxy_classification_code/galaxy_shape","/astronomy/near_earth_object/near_earth_object_classification","/astronomy/orbital_relationship/orbit_type","/astronomy/star/spectral_type","/astronomy/telescope/type_of_telescope","/automotive/model/automotive_class","/automotive/transmission/classification","/aviation/aircraft_model/aircraft_type","/aviation/airliner_accident/accident_type","/aviation/airport/airport_type","/aviation/aviation_waypoint/waypoint_type","/award/competition/type_of_competition","/bicycles/bicycle_model/bicycle_type","/biology/breed_registration/breed_group","/biology/fossil_specimen/organism","/biology/gene_group_membership/group","/biology/gene_ontology_group/group_type","/biology/organism/organism_type","/biology/organism/sex","/biology/organism_classification/rank","/biology/pedigreed_animal/breed","/boats/ship/ship_class","/boats/ship_class/ship_type","/book/book_edition/binding","/book/periodical_format_period/format","/book/poem/verse_form","/book/short_non_fiction/mode_of_writing","/business/consumer_product/category","/business/issue/type_of_issue","/business/product_line/category","/celebrities/sexual_orientation_phase/sexual_orientation","/chemistry/chemical_compound/classifications","/chemistry/chemical_element/chemical_series","/chemistry/chemical_element/periodic_table_block","/computer/computer_peripheral/peripheral_class","/computer/file_format/genre","/conferences/conference_series/type_of_conference","/cricket/cricket_match/match_type","/cvg/computer_videogame/gameplay_modes","/digicams/digital_camera/format","/distilled_spirits/blended_spirit/style","/distilled_spirits/distilled_spirit/spirit_type","/distilled_spirits/infused_spirit/infusion_style","/education/educational_institution/school_type","/education/fraternity_sorority/fraternity_sorority_type","/engineering/battery/cell_type","/engineering/battery/size","/engineering/battery_size/shape_format","/engineering/engine/category","/engineering/piston_engine/cooling_method","/engineering/piston_engine/fuel_delivery_method","/engineering/piston_engine/piston_configuration","/engineering/piston_engine/valvetrain_configuration","/engineering/power_plug_standard/plug_type","/event/disaster/type_of_disaster","/event/speech_or_presentation/type_or_format_of_presentation","/exhibitions/exhibition/exhibition_types","/fashion/textile/weave","/fictional_universe/fictional_setting/setting_type","/film/film/film_format","/food/beer/beer_style","/food/beer_style/bjcp_style_category","/food/cheese/texture","/food/dish/type_of_dish1","/food/drinking_establishment/drinking_establishment_type","/food/tea/tea_type","/food/wine_style/wine_types","/geography/geographical_feature/category","/geography/glacier/glacier_type","/geography/lake/lake_type","/geography/mountain/listings","/geography/mountain/mountain_type","/geography/waterfall/waterfall_type","/government/government_office_or_title/category","/government/government_position_held/basic_title","/interests/collectable_item/collection_category","/internet/top_level_domain/domain_type","/language/conlang/conlang_type","/language/language_writing_system/type_of_writing","/law/us_patent/international_classification","/law/us_patent/us_classification_category","/law/us_patent/us_patent_type","/location/administrative_division_capital_relationship/capital_type","/location/country/form_of_government","/location/location_symbol_relationship/Kind_of_symbol","/martial_arts/martial_art/category","/medicine/cancer_center/cancer_center_type","/medicine/drug/drug_class","/medicine/drug/mechanism_of_action","/medicine/drug_formulation/dosage_form","/medicine/drug_formulation/drug_category","/medicine/hospital_ownership/ownership_status","/medicine/infectious_disease/infectious_agent_type","/medicine/medical_trial/design","/medicine/medical_trial/phase","/medicine/medical_trial/type_of_trial","/meteorology/cloud/classification","/meteorology/tropical_cyclone/category","/metropolitan_transit/transit_line/service_type","/military/military_unit/unit_size","/music/album/release_type","/music/composition/form","/music/opera_singer/voice_type","/music/release/format","/organization/organization/legal_structure","/organization/organization/organization_type","/people/person/ethnicity","/people/person/gender","/physics/particle/family","/physics/particle/generation","/protected_sites/natural_or_cultural_site_designation/categories","/protected_sites/natural_or_cultural_site_listing/designation","/protected_sites/protected_site/iucn_category","/rail/locomotive_class/gauge","/rail/railway_gauge_relationship/gauge","/rail/railway_type_relationship/railway_type","/rail/steam_locomotive_class/fuel_type","/rail/steam_locomotive_class/wheel_configuration","/religion/place_of_worship/religion","/religion/place_of_worship/type_of_place_of_worship","/religion/place_of_worship_historical_use/religion","/religion/religious_leadership_jurisdiction/size_or_type","/royalty/chivalric_rank/gender","/royalty/noble_rank/gender","/royalty/order_of_chivalry/category","/skiing/lift_tenure/lift_type","/skiing/ski_run/rating","/spaceflight/bipropellant_rocket_engine/engine_cycle","/spaceflight/rocket/rocket_function","/spaceflight/satellite/primary_use","/sports/boxer/weight_division","/time/holiday/type_of_holiday","/transportation/bridge/bridge_type","/travel/accommodation/accommodation_type","/visual_art/artwork/art_form","/wine/wine/color","/wine/wine/wine_style","/wine/wine/wine_type","/zoos/zoo/category","/people/person/profession","/soccer/football_player/position_s","/american_football/football_historical_roster_position/position_s","/american_football/football_player/position_s","/american_football/football_roster_position/position","/baseball/baseball_player/position_s","/baseball/baseball_roster_position/position","/basketball/basketball_player/position_s","/basketball/basketball_roster_position/position","/ice_hockey/hockey_player/hockey_position","/ice_hockey/hockey_roster_position/position","/soccer/football_player/position_s","/soccer/football_roster_position/position"],"undefined"!=typeof define&&define.amd?define([],function(){return a}):"undefined"!=typeof module&&module.exports&&(module.exports=a),a}(),http=function(){function a(a){console.log(a),$("body").append(JSON.stringify(a))}function b(a){try{return JSON.parse(a)}catch(b){return a}}var c={};if("undefined"!=typeof window&&window.screen)console.log("clientside"),c.get=function(c,d){d=d||a,$.get(c,function(a){d(b(a))}).fail(function(a){d(a.statusText||"error")})},c.jsonp=function(c,d){d=d||a,$.getJSON(c,function(a){d(b(a))}).fail(function(a){d(a.statusText||"error")})},c.post=function(c,d,e){e=e||a,$.post(c,d,function(a){e(b(a))}).fail(function(a){e(a.statusText||"error")})};else if("undefined"!=typeof module&&module.exports){var d=require("request");c.get=function(a,b){b=b||console.log,d({uri:a},function(a,c,d){c&&200==c.statusCode?b(JSON.parse(d)):(console.log("==="+c.statusCode+" error=="),console.log(d),b({error:d}))})},c.post=function(a,c,e){e=e||console.log,"object"==typeof c&&(c=JSON.stringify(c)),d({url:"http://api.freebase.com/api/service/mqlread",method:"POST",body:c},function(a,c,d){e(b(d))})}}return"undefined"!=typeof define&&define.amd?define([],function(){return c}):"undefined"!=typeof module&&module.exports&&(module.exports=c),c}();if("undefined"!=typeof module&&module.exports)var http=require("./http");var fns=function(){var a={};return a.command_line_ask=function(a,b,c){var d=process.stdin,e=process.stdout;d.resume(),console.log(a+": "),d.once("data",function(d){d=d.toString().trim(),b.test(d)?c(d):(e.write("paste in the data and press enter ;)\n"),ask(a,b,c))})},a.mql_encode=function(a){if(this.doc="quote a unicode string to turn it into a valid mql /type/key/value",!a)return"";a=a.replace(/  /," "),a=a.replace(/^\s+|\s+$/,""),a=a.replace(/ /g,"_");var b="A-Za-z0-9",c="A-Za-z0-9_-",d=new RegExp("^["+b+"]["+c+"]*$"),e=new RegExp("([^"+c+"])","g");if(d.exec(a))return a;var f=function(a,b){var c=b.charCodeAt(0).toString(16).toUpperCase();return 2==c.length&&(c="00"+c),3==c.length&&(c="0"+c),"$"+c},g=a.replace(e,f);return("-"==g.charAt(0)||"_"==g.charAt(0))&&(g=f(g,g.charAt(0))+g.substr(1)),g},a.parsedate=function(a){var b=a.match(/(\d+)/g);return new Date(b[0],b[1]-1,b[2])},a.flatten=function(a){return a.reduce(function(a,b){return a.concat(b)},[])},a.http=function(a,b){http.get(a,b)},a.isin=function(a,b){return b.some(function(b){return b==a})},a.compact=function(a){return a.filter(function(a){return a})},a.compact_strong=function(b){return a.unique(a.compact(b)).filter(function(b){return 0==a.isEmpty(b)})},a.isEmpty=function(b){if(null==b)return!0;if("array"==a.jstype(b)||"string"==a.jstype(b))return 0===b.length;for(var c in b)if(void 0!=b[c])return!1;return!0},a.unique=function(a,b){if(b){var c=new Array;a:for(var d=0;d<a.length;d++){for(var e=0;e<c.length;e++)if(c[e][b]==a[d][b])continue a;c[c.length]=a[d]}return c}var c=new Array;a:for(var d=0;d<a.length;d++){for(var e=0;e<c.length;e++)if(c[e]==a[d])continue a;c[c.length]=a[d]}return c},a.extend=function(a,b){for(var c in b)a[c]=b[c];return a},a.parseurl=function(a){for(var b={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},c=b.parser[b.strictMode?"strict":"loose"].exec(a),d={},e=14;e--;)d[b.key[e]]=c[e]||"";return d[b.q.name]={},d[b.key[12]].replace(b.q.parser,function(a,c,e){c&&(d[b.q.name][c]=e)}),d},a.isid=function(a){return a.match(/^\/[^ ]*?\/[^ ]*?$/)?!0:!1},a.jstype=function(a){var b,c,d,e,f,g;if(void 0===a||null===a)return"null";for(b=new Object,g="Boolean Number String Function Array Date RegExp".split(" "),e=0,f=g.length;f>e;e++)d=g[e],b["[object "+d+"]"]=d.toLowerCase();return c=Object.prototype.toString.call(a),c in b?b[c]:"object"},"undefined"!=typeof define&&define.amd?define([],function(){return a}):"undefined"!=typeof module&&module.exports&&(module.exports=a),a}(),slow=function(){var a=function(a,b,c,d){function e(){f++;var i=f;h++,c.debug&&console.log("sending #"+f+" - ("+h+" going at once)"),b(a[f],function(b){return console.log(b),h-=1,g[i]=b,f<a.length-1?e():0>=h?d(g):void 0})}var f=-1,g=[],h=0;d=d||console.log,c=c||{},c.max=Math.abs(c.max)||5,c.verbose=c.verbose||!1,c.debug=c.debug||!1,"function"!=typeof c.monitor&&(c.monitor=!1);for(var i=0;i<c.max&&i<a.length;i++)e()};return"undefined"!=typeof define&&define.amd?define([],function(){return a}):"undefined"!=typeof module&&module.exports&&(module.exports=a),a}();if("undefined"!=typeof module&&module.exports){var request=require("request"),fns=require("./helpers"),data=require("./data"),wikipedia=require("./wikipedia"),slow=require("./slow"),request=require("request"),googleapis=require("googleapis"),OAuth2Client=googleapis.OAuth2Client,fs=require("fs"),path=require("path"),file=path.resolve(path.dirname(require.main.filename),"oauth_data.json"),oauth_data={};fs.existsSync(file)&&(oauth_data=JSON.parse(fs.readFileSync(file)))}var freebase=function(){function a(a){return a=a||{},"string"==a.valuetype||"uri"==a.valuetype||"int"==a.valuetype?a.values.map(function(a){return a.text}):"datetime"==a.valuetype?a.values.map(function(a){return fns.parsedate(a.text)}):"object"==a.valuetype?a.values.map(function(a){return{id:a.id,name:a.text}}):a.values}var b={};return b.api_key="AIzaSyD5GmnQC7oW9GJIWPGsJUojspMMuPusAxI",b.host="https://www.googleapis.com/freebase/v1",b.data=data,b.wikipedia=wikipedia,b.default_callback=function(a){console.log(JSON.stringify(a,null,2))},b.authenticate=function(a){a=a||console.log;var c=(new Date).getTime();if(oauth_data&&oauth_data.token&&oauth_data.token.alive_until>c){var d=(oauth_data.token.alive_until-c)/1e3/60;return console.log("your token is good for another "+parseInt(d)+" minutes"),b.access_token=oauth_data.token.access_token,a(),void 0}var e=new OAuth2Client(oauth_data.CLIENT_ID,oauth_data.CLIENT_SECRET,oauth_data.REDIRECT_URL),f=e.generateAuthUrl({scope:"https://www.googleapis.com/auth/freebase"});console.log("please visit this url to get your code: "),console.log(f),console.log(" "),fns.command_line_ask("what is the 'code' parameter on the page you redirected to?",/.+/,function(c){e.getToken(c,function(c,d){c&&console.log(c);var e=new Date;d.alive_until=e.setSeconds(e.getSeconds()+d.expires_in),b.access_token=d.access_token,oauth_data.token=d;var f=JSON.stringify(oauth_data,null,4);fs.writeFile(file,f,function(b){b&&console.log(b),a()})})})},b.Topic=function(c){var d=this;if(d instanceof b.Topic)return d;var e=fns.jstype(c);return"null"==e?{}:("string"==e&&(fns.isid(c)?c={id:c}:(console.log(JSON.stringify(c)+" is not a freebase id"),process.exit(code=1))),d.id=c.id||c.mid,d.mid=c.mid||c.id,d.name=c.name||c.text||c.title,d.get=function(c,e,f){f=new b.Option(f),e=e||b.default_callback,b.reconcile_property(c,function(c){f.property=c.id,b.topic_api(d,function(b){return b.property&&0!=b.property.length?e(a(b.property[f.property])):(e([]),void 0)},f)},f)},d.set=function(a,c,e,f){f=new b.Option(f),e=e||b.default_callback,b.reconcile_property(a,function(a){var g={id:d.id};g[a.id]={id:c,connect:f.connect||"insert"},b.mqlwrite(g,function(b){b&&b.result&&b.result.id?console.log([b.result.id,b.result[a.id].id,b.result[a.id].connect,b.result.name].join("   	")):(console.log("=======error====="),console.log(JSON.stringify(b,null,2)),console.log("=======error=====")),e(b)},f)})},d.add_type=function(a,b,c){d.set("/type/object/type",a,b,c)},d=fns.extend(d,c),void 0)},b.Property=function(a){var b=this,c=fns.jstype(a);return"null"==c?{}:("string"==c&&(fns.isid(a)?a={id:a}:(console.log(JSON.stringify(a)+" is not a freebase id"),process.exit(code=1))),b.id=a.id||a.mid,b.mid=a.mid||a.id,b.type=function(){return b.mid.split(/\//g).slice(0,3).join("/")}(),void 0)},b.Topiclist=function(a){var c=this,d=fns.jstype(a);return"null"==d?{}:(c.data=c.data||a.map(function(a){return new b.Topic(a)}),c.get=function(a,b,d){var e=function(b,c){b.get(a,c,d)};slow(c.data,e,{},function(d){c.data=c.data.map(function(b,c){return b[a]=d[c],b}),b(c.data)})},c.set=function(){},c.select=function(){},c.reject=function(){},c.each=function(a,d){var e=function(b,c){c=c||console.log,a(b,c)};d=d||b.default_callback,slow.quick(c.data,e,{debug:!0},d)},void 0)},b.Option=function(a){var c=this;a=a||{},c.key=b.api_key,c.property=a.property,c.type=a.type,c=fns.extend(c,a)},b.mql_encode=function(a){if(this.doc="quote a unicode string to turn it into a valid mql /type/key/value",!a)return"";a=a.replace(/  /," "),a=a.replace(/^\s+|\s+$/,""),a=a.replace(/ /g,"_");var b="A-Za-z0-9",c="A-Za-z0-9_-",d=new RegExp("^["+b+"]["+c+"]*$"),e=new RegExp("([^"+c+"])","g");if(d.exec(a))return a;var f=function(a,b){var c=b.charCodeAt(0).toString(16).toUpperCase();return 2==c.length&&(c="00"+c),3==c.length&&(c="0"+c),"$"+c},g=a.replace(e,f);return("-"==g.charAt(0)||"_"==g.charAt(0))&&(g=f(g,g.charAt(0))+g.substr(1)),g},b.fetch=function(a,c,d){this.description="lookup a specific property in the topic api",c=c||b.default_callback,d=new b.Option(d),b.topic_api(a,function(a){return c(a.property)},d)},b.topic_api=function(a,c,d){this.description="call the freebase topic api",d=new b.Option(d),a=new b.Topic(a),console.log(a),c=c||b.default_callback;var e=d.property||d.type||"all",f=b.host+"/topic"+a.mid+"?key="+(d.key||"")+"&filter="+(e||"all");fns.http(f,function(a){return c(a)},d)},b.search_api=function(a,c,d){this.description="call the freebase search api",d=new b.Option(d),c=c||b.default_callback;var e=b.host+"/search?query="+encodeURIComponent(a)+"&key="+(d.key||"");fns.http(e,function(a){var d=new b.Topiclist(a.result);return c(d)})},b.mqlread=function(a,c,d){this.description="call the freebase mql api",d=new b.Option(d),c=c||b.default_callback;var e=b.host+"/mqlread?query="+encodeURIComponent(JSON.stringify(a))+"&key="+(d.key||"")+"&cursor="+(d.cursor||"");fns.http(e,function(a){return c(a)})},b.mqlwrite=function(a,c,d){this.description="call the freebase mql api",d=new b.Option(d),c=c||b.default_callback,d.oauth_token=d.oauth_token||b.access_token||d.oauth||d.token;var e=b.host+"/mqlwrite?query="+encodeURIComponent(JSON.stringify(a))+"&oauth_token="+(d.oauth_token||"");fns.http(e,c)},b.paginate=function(a,c,d){this.description="call the freebase mql api until it finishes, or reaches your maximum",d=new b.Option(d),c=c||b.default_callback,d.max=d.max||d.maximum||6e3;var e=[];!function f(g){d.cursor=g,console.log(e.length),b.mqlread(a,function(a){e=e.concat(a.result),a.cursor&&e.length<d.max?f(a.cursor):c(e)},d)}()},b.reconcile_property=function(a,c,d){c=c||b.default_callback,d=new b.Option(d),fns.isid(a)?c(new b.Property(a)):b.data.properties[a]&&c(new b.Property(b.data.properties[a]))},b.test_write=function(a){var c={id:"/en/radiohead",type:{id:"/music/artist",connect:"insert"}};b.mqlwrite(c,function(b){return a(b&&b.result&&b.result.type&&"insert"==b.result.type.connect)})},"undefined"!=typeof define&&define.amd?define([],function(){return b}):"undefined"!=typeof module&&module.exports&&(module.exports=b),b}();freebase.topic_api("/en/radiohead",function(a){console.log(a)}),radiohead=new freebase.Topic("/en/radiohead"),console.log(radiohead instanceof freebase.Topic);